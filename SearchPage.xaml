<Page x:Class="SubsonicUWP.SearchPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:SubsonicUWP"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" mc:Ignorable="d">

    <Page.Resources>
        <!-- Reusing templates similar to HomePage -->
        <DataTemplate x:Key="SongTemplate">
            <Grid Width="120" Margin="0,0,12,12" Background="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}" RightTapped="MediaItemGrid_RightTapped" Holding="MediaItemGrid_Holding">
                <!-- Context Menu Resource Wrapper -->
                <FlyoutBase.AttachedFlyout>
                    <MenuFlyout>
                        <MenuFlyoutItem Text="Add to current queue" Click="AddToQueue_Click" Icon="Add"/>
                        <MenuFlyoutItem Text="Play next" Click="PlayNext_Click" Icon="Upload"/>
                        <!-- Favorite removed for Albums/Artists as requested -->
                        <MenuFlyoutItem Text="Add to cache" Click="AddToCache_Click" Icon="Download"/>
                        <MenuFlyoutItem Text="Export as mp3" Click="Export_Click" Icon="SaveLocal"/>
                    </MenuFlyout>
                </FlyoutBase.AttachedFlyout>

                <Grid.RowDefinitions>
                    <RowDefinition Height="120"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Text="&#xE93C;" FontFamily="Segoe MDL2 Assets" FontSize="40" Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" HorizontalAlignment="Center" VerticalAlignment="Center" Opacity="0.5" Visibility="{Binding ImageUrl, Converter={StaticResource NullToVis}}"/>
                <Image Source="{Binding ImageUrl}" Stretch="UniformToFill"/>

                <Border Grid.Row="1" Padding="4">
                    <StackPanel>
                        <TextBlock Text="{Binding Title}" Foreground="{ThemeResource ForegroundBrush}" TextTrimming="CharacterEllipsis" FontSize="12" FontWeight="SemiBold"/>
                        <TextBlock Text="{Binding Artist}" Foreground="{ThemeResource SystemControlPageTextBaseMediumBrush}" TextTrimming="CharacterEllipsis" FontSize="11"/>
                    </StackPanel>
                </Border>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="RowSongTemplate">
            <Grid Margin="0,4" Background="Transparent" RightTapped="MediaItemGrid_RightTapped" Holding="MediaItemGrid_Holding" Padding="8">
                <FlyoutBase.AttachedFlyout>
                    <MenuFlyout>
                        <MenuFlyoutItem Text="Add to current queue" Click="AddToQueue_Click" Icon="Add"/>
                        <MenuFlyoutItem Text="Play next" Click="PlayNext_Click" Icon="Upload"/>
                        <MenuFlyoutItem Text="Favorite" Click="Favorite_Click" Icon="Favorite"/>
                        <MenuFlyoutItem Text="Add to cache" Click="AddToCache_Click" Icon="Download"/>
                        <MenuFlyoutItem Text="Export as mp3" Click="Export_Click" Icon="SaveLocal"/>
                    </MenuFlyout>
                </FlyoutBase.AttachedFlyout>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Grid Width="48" Height="48" Margin="0,0,12,0" Background="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}">
                    <TextBlock Text="&#xE93C;" FontFamily="Segoe MDL2 Assets" FontSize="24" Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" HorizontalAlignment="Center" VerticalAlignment="Center" Opacity="0.5" Visibility="{Binding ImageUrl, Converter={StaticResource NullToVis}}"/>
                    <Image Source="{Binding ImageUrl}" Stretch="UniformToFill"/>
                </Grid>
                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock Text="{Binding Title}" Foreground="{ThemeResource ForegroundBrush}" FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding Artist}" Foreground="{ThemeResource SecondaryForegroundBrush}" Opacity="0.7" FontSize="12"/>
                </StackPanel>
                <TextBlock Grid.Column="2" Text="{Binding DurationFormatted}" Foreground="{ThemeResource SecondaryForegroundBrush}" Opacity="0.5" VerticalAlignment="Center" Margin="12,0"/>
            </Grid>
        </DataTemplate>

        <local:StringNullOrEmptyToVisibilityConverter x:Key="NullToVis"/>
    </Page.Resources>

    <Grid Background="{ThemeResource WindowBackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0" Margin="24,12,24,12">
            <AutoSuggestBox x:Name="PageSearchBox" QueryIcon="Find" PlaceholderText="Search songs, artists, albums..." QuerySubmitted="PageSearchBox_QuerySubmitted" Margin="0,0,0,12"/>
            <TextBlock x:Name="TitleBlock" Text="Search Results" FontSize="32" FontWeight="Light" FontFamily="Segoe UI Light" Visibility="Collapsed"/>
        </StackPanel>

        <ScrollViewer Grid.Row="1" Padding="24,0,24,24">
            <StackPanel>
                <!-- Songs -->
                <TextBlock Text="Songs" FontSize="20" FontWeight="SemiBold" Margin="0,12" Foreground="{ThemeResource ForegroundBrush}" Visibility="{Binding SongsVisibility}"/>
                <ListView ItemsSource="{Binding Results.Songs}" ItemTemplate="{StaticResource RowSongTemplate}" SelectionMode="None" IsItemClickEnabled="True" ItemClick="Song_ItemClick">
                    <ListView.ItemContainerStyle>
                        <Style TargetType="ListViewItem">
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        </Style>
                    </ListView.ItemContainerStyle>
                </ListView>

                <!-- Albums -->
                <TextBlock Text="Albums" FontSize="20" FontWeight="SemiBold" Margin="0,24,0,12" Foreground="{ThemeResource ForegroundBrush}" Visibility="{Binding AlbumsVisibility}"/>
                <GridView ItemsSource="{Binding Results.Albums}" ItemTemplate="{StaticResource SongTemplate}" SelectionMode="None" IsItemClickEnabled="True" ItemClick="Album_ItemClick">
                    <GridView.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapGrid Orientation="Horizontal" MaximumRowsOrColumns="6"/>
                        </ItemsPanelTemplate>
                    </GridView.ItemsPanel>
                </GridView>

                <!-- Artists -->
                <TextBlock Text="Artists" FontSize="20" FontWeight="SemiBold" Margin="0,24,0,12" Foreground="{ThemeResource ForegroundBrush}" Visibility="{Binding ArtistsVisibility}"/>
                <GridView ItemsSource="{Binding Results.Artists}" ItemTemplate="{StaticResource SongTemplate}" SelectionMode="None" IsItemClickEnabled="True" ItemClick="Artist_ItemClick">
                    <GridView.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapGrid Orientation="Horizontal" MaximumRowsOrColumns="6"/>
                        </ItemsPanelTemplate>
                    </GridView.ItemsPanel>
                </GridView>
            </StackPanel>
        </ScrollViewer>

        <StackPanel x:Name="LoadingPanel" Grid.RowSpan="2" VerticalAlignment="Center" HorizontalAlignment="Center" Visibility="Collapsed">
            <ProgressRing IsActive="True" Width="50" Height="50" Foreground="{ThemeResource ForegroundBrush}"/>
            <TextBlock Text="Searching..." Margin="0,12,0,0" HorizontalAlignment="Center" Foreground="{ThemeResource ForegroundBrush}"/>
        </StackPanel>
    </Grid>
</Page>
