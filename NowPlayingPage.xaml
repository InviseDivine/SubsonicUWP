<Page x:Class="SubsonicUWP.NowPlayingPage" x:Name="PageRoot"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:SubsonicUWP"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" mc:Ignorable="d">

    <Page.Resources>
        <MenuFlyout x:Key="QueueItemMenu">
            <MenuFlyoutItem Text="Play now" Click="PlayNow_Click"/>
            <MenuFlyoutItem Text="Play next" Click="PlayNext_Click"/>
            <MenuFlyoutItem Text="Remove from queue" Click="Remove_Click"/>
            <MenuFlyoutItem Text="Add to playlist" Click="AddToPlaylist_Click"/>
            <MenuFlyoutItem Text="Favorite" Click="Favorite_Click"/>
            <MenuFlyoutItem Text="Download" Click="Download_Click"/>
        </MenuFlyout>
    </Page.Resources>

    <Grid>
        <Grid.Background>
            <ImageBrush Opacity="0.1" Stretch="UniformToFill">
                <!-- Placeholder for background art blur -->
            </ImageBrush>
        </Grid.Background>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="400"/>
        </Grid.ColumnDefinitions>

        <!-- Left: Art & Info -->
        <Grid Grid.Column="0" Margin="48">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Art -->
            <Image Source="{Binding CurrentSong.ImageUrl}" Stretch="Uniform" VerticalAlignment="Center" HorizontalAlignment="Center" MaxWidth="500" MaxHeight="500"/>

            <!-- Info -->
            <StackPanel Grid.Row="1" HorizontalAlignment="Center" Margin="0,32,0,0">
                <TextBlock Text="{Binding CurrentSong.Title}" FontSize="32" FontWeight="SemiBold" TextAlignment="Center"/>
                <TextBlock Text="{Binding CurrentSong.Artist}" FontSize="18" Opacity="0.7" TextAlignment="Center" Margin="0,8,0,0"/>
            </StackPanel>
            <!-- Progress -->
            <!-- Progress -->
            <Grid Grid.Row="2" Margin="0,24" VerticalAlignment="Bottom">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="{Binding CurrentPositionFormatted}" VerticalAlignment="Center" Foreground="#AAA" Margin="0,0,12,0"/>
                <Slider x:Name="TimeSlider" Grid.Column="1" Value="{Binding CurrentPosition, Mode=TwoWay}" Maximum="{Binding Duration}" VerticalAlignment="Center" ThumbToolTipValueConverter="{StaticResource SliderTooltipConverter}"/>
                <TextBlock Grid.Column="2" Text="{Binding DurationFormatted}" VerticalAlignment="Center" Foreground="#AAA" Margin="12,0,0,0"/>
            </Grid>
        </Grid>

        <!-- Right: Queue / Lyrics -->
        <Grid Grid.Column="1" Background="#0AFFFFFF">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <TextBlock Text="Up Next" FontSize="20" FontWeight="SemiBold" Margin="24,24,0,12"/>

            <ListView Grid.Row="1" ItemsSource="{Binding PlaybackQueue}" SelectedIndex="{Binding CurrentQueueIndex, Mode=TwoWay}" Background="Transparent" BorderThickness="0" ScrollViewer.VerticalScrollBarVisibility="Hidden" Padding="12,0" CanReorderItems="True" AllowDrop="True" CanDragItems="True" IsItemClickEnabled="True" ItemClick="QueueList_ItemClick">
                <ListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem">
                        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        <Setter Property="Padding" Value="0"/>
                    </Style>
                </ListView.ItemContainerStyle>
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Grid Margin="0,8" FlyoutBase.AttachedFlyout="{StaticResource QueueItemMenu}" RightTapped="QueueItemGrid_RightTapped" Holding="QueueItemGrid_Holding">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="48"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Image Source="{Binding ImageUrl}" Width="48" Height="48" Stretch="UniformToFill"/>
                            <StackPanel Grid.Column="1" Margin="12,0,0,0" VerticalAlignment="Center">
                                <TextBlock Text="{Binding Title}" FontWeight="SemiBold"/>
                                <TextBlock Text="{Binding Artist}" Opacity="0.7" FontSize="12"/>
                            </StackPanel>
                            <Grid Grid.Column="2" Margin="12,0,0,0">
                                <TextBlock Text="&#xE700;" FontFamily="Segoe MDL2 Assets" FontSize="12" VerticalAlignment="Center" HorizontalAlignment="Center" Opacity="0.3"/>
                            </Grid>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </Grid>
    </Grid>
</Page>
